<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>01. 第一个端对端测试 | matman.js</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/matman/logo.png">
    <meta name="description" content="web 端对端测试解决方案">
    <link rel="preload" href="/matman/assets/css/0.styles.734c5509.css" as="style"><link rel="preload" href="/matman/assets/js/app.b3f8f6ce.js" as="script"><link rel="preload" href="/matman/assets/js/3.401d6b26.js" as="script"><link rel="preload" href="/matman/assets/js/2.d54e6689.js" as="script"><link rel="preload" href="/matman/assets/js/15.b891806f.js" as="script"><link rel="prefetch" href="/matman/assets/js/10.07c8118b.js"><link rel="prefetch" href="/matman/assets/js/11.9019913b.js"><link rel="prefetch" href="/matman/assets/js/12.12850e42.js"><link rel="prefetch" href="/matman/assets/js/13.4e9dd721.js"><link rel="prefetch" href="/matman/assets/js/14.c6344b78.js"><link rel="prefetch" href="/matman/assets/js/16.57d092a6.js"><link rel="prefetch" href="/matman/assets/js/17.697ce94f.js"><link rel="prefetch" href="/matman/assets/js/18.39e9facc.js"><link rel="prefetch" href="/matman/assets/js/19.b99ac8cd.js"><link rel="prefetch" href="/matman/assets/js/20.ef0eb1f8.js"><link rel="prefetch" href="/matman/assets/js/21.4e253c96.js"><link rel="prefetch" href="/matman/assets/js/22.244306ca.js"><link rel="prefetch" href="/matman/assets/js/23.19c16e70.js"><link rel="prefetch" href="/matman/assets/js/24.a5112f0a.js"><link rel="prefetch" href="/matman/assets/js/25.04f70ab5.js"><link rel="prefetch" href="/matman/assets/js/26.85b84988.js"><link rel="prefetch" href="/matman/assets/js/27.233fe0f8.js"><link rel="prefetch" href="/matman/assets/js/28.44525bbf.js"><link rel="prefetch" href="/matman/assets/js/29.aec3bd90.js"><link rel="prefetch" href="/matman/assets/js/30.077508ea.js"><link rel="prefetch" href="/matman/assets/js/31.65ba1d41.js"><link rel="prefetch" href="/matman/assets/js/32.01ab2572.js"><link rel="prefetch" href="/matman/assets/js/33.32be7a84.js"><link rel="prefetch" href="/matman/assets/js/34.1fd6a0ea.js"><link rel="prefetch" href="/matman/assets/js/35.7ad8f4c5.js"><link rel="prefetch" href="/matman/assets/js/36.9f049634.js"><link rel="prefetch" href="/matman/assets/js/37.9dbcf3f8.js"><link rel="prefetch" href="/matman/assets/js/38.9e91c8c7.js"><link rel="prefetch" href="/matman/assets/js/39.46a25416.js"><link rel="prefetch" href="/matman/assets/js/4.fd4364ff.js"><link rel="prefetch" href="/matman/assets/js/5.65686d23.js"><link rel="prefetch" href="/matman/assets/js/6.fd2c0ce0.js"><link rel="prefetch" href="/matman/assets/js/7.c4973086.js"><link rel="prefetch" href="/matman/assets/js/8.558ec8a3.js"><link rel="prefetch" href="/matman/assets/js/9.a087590a.js">
    <link rel="stylesheet" href="/matman/assets/css/0.styles.734c5509.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container fastest-docs-container"><!----> <header style="background-color:rgba(255, 255, 255, 1);box-shadow:0px 2px 30px 0px rgba(0, 0, 0, 0.1);" data-v-e3902e94><nav data-v-e3902e94><a href="/matman/" class="router-link-active" data-v-e3902e94><img src="/matman/assets/img/logo_100.285fceb1.png" alt="logo" style="height:50px;" data-v-e3902e94></a> <ul class="navs" data-v-e3902e94><li class="nav" data-v-e3902e94><a href="/matman/docs/" class="router-link-active nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-e3902e94>web端对端测试方案
                </a> <!----></li><li class="nav" data-v-e3902e94><a href="/matman/api/" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-e3902e94>API手册
                </a> <!----></li><li class="nav" data-v-e3902e94><a href="/matman/tool/" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-e3902e94>工具
                </a> <!----></li><li class="nav" data-v-e3902e94><a href="/matman/release/" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-e3902e94>发布日志
                </a> <!----></li><li class="nav" data-v-e3902e94><a href="https://github.com/matmanjs/matman/issues" target="_blank" rel="noopener noreferrer" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-e3902e94>Issues</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" data-v-e3902e94 data-v-e3902e94><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></li></ul></nav></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/matman/docs/" aria-current="page" class="sidebar-link">关于 matman</a></li><li><a href="/matman/docs/install.html" class="sidebar-link">安装和升级</a></li><li><section class="sidebar-group depth-0"><a href="/matman/docs/getting-started/" class="sidebar-heading clickable router-link-active open"><span>快速入门</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/matman/docs/getting-started/baidu_01.html" aria-current="page" class="active sidebar-link">01. 第一个端对端测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/matman/docs/getting-started/baidu_01.html#_1-编写端对端测试" class="sidebar-link">1. 编写端对端测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/matman/docs/getting-started/baidu_01.html#_1-1-编写数据快照爬虫脚本" class="sidebar-link">1.1 编写数据快照爬虫脚本</a></li><li class="sidebar-sub-header"><a href="/matman/docs/getting-started/baidu_01.html#_1-2-编写无头浏览器操作" class="sidebar-link">1.2 编写无头浏览器操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/matman/docs/getting-started/baidu_01.html#_2-编写测试用例" class="sidebar-link">2. 编写测试用例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/matman/docs/getting-started/baidu_01.html#_2-1-测试过程分离" class="sidebar-link">2.1 测试过程分离</a></li><li class="sidebar-sub-header"><a href="/matman/docs/getting-started/baidu_01.html#_2-2-单文件测试" class="sidebar-link">2.2 单文件测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/matman/docs/getting-started/baidu_01.html#_3-执行测试" class="sidebar-link">3. 执行测试</a></li></ul></li><li><a href="/matman/docs/getting-started/baidu_02.html" class="sidebar-link">02. 测试用户交互</a></li><li><a href="/matman/docs/getting-started/baidu_03.html" class="sidebar-link">03. 更多例子</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>深入</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matman/docs/improve/summary.html" class="sidebar-link">01. 综述</a></li><li><a href="/matman/docs/improve/simple.html" class="sidebar-link">02. 简单静态页面</a></li><li><a href="/matman/docs/improve/transaction.html" class="sidebar-link">03. 单一接口展示型页面</a></li><li><a href="/matman/docs/improve/withdraw.html" class="sidebar-link">04. 重交互界面</a></li><li><a href="/matman/docs/improve/jsBridge.html" class="sidebar-link">05. JSBridge</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基本理论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matman/docs/basic-concepts/page-snapshot.html" class="sidebar-link">页面快照</a></li><li><a href="/matman/docs/basic-concepts/data-snapshot.html" class="sidebar-link">数据快照</a></li><li><a href="/matman/docs/basic-concepts/test-by-mock.html" class="sidebar-link">基于白盒数据测试数据快照</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>FAQ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matman/docs/faq/common.html" class="sidebar-link">常见问题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_01-第一个端对端测试"><a href="#_01-第一个端对端测试" class="header-anchor">#</a> 01. 第一个端对端测试</h1> <p>本节我们将实现：测试 <a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer">https://www.baidu.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 首页的UI布局。</p> <blockquote><p>最终的代码参考： <a href="https://github.com/matmanjs/matman-demo-getting-started/tree/master/baidu_01" target="_blank" rel="noopener noreferrer">https://github.com/matmanjs/matman-demo-getting-started/tree/master/baidu_01<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="_1-编写端对端测试"><a href="#_1-编写端对端测试" class="header-anchor">#</a> 1. 编写端对端测试</h2> <h3 id="_1-1-编写数据快照爬虫脚本"><a href="#_1-1-编写数据快照爬虫脚本" class="header-anchor">#</a> 1.1 编写数据快照爬虫脚本</h3> <p>编写数据快照爬虫，内容如下（需要注意的是在本项目中 <code>未出现此函数</code>，而是直接写在了 <code>matman</code> 流程中）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">spider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> document<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
    width<span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
    height<span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
    userAgent<span class="token operator">:</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span>
    _version<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    searchBtnTxt<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#su&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-2-编写无头浏览器操作"><a href="#_1-2-编写无头浏览器操作" class="header-anchor">#</a> 1.2 编写无头浏览器操作</h3> <p>在 <code>case_modules/page_baidu_index/basic-check.matman.js</code> 文件中，有如下内容：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> matman <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'matman'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>BrowserRunner<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'matman-runner-puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">opts</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化 pageDriver</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> matman<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BrowserRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置浏览器参数</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setDeviceConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    userAgent<span class="token operator">:</span>
      <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36 mycustomua'</span><span class="token punctuation">,</span>
    viewport<span class="token operator">:</span> <span class="token punctuation">{</span>
      width<span class="token operator">:</span> <span class="token number">1250</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置截屏</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setScreenshotConfig</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置 URL</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setPageUrl</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置 action</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">page</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">'#su'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 执行返回结果</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> document<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
      width<span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
      height<span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
      userAgent<span class="token operator">:</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span>
      _version<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      searchBtnTxt<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#su'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-2-1-流程概览"><a href="#_1-2-1-流程概览" class="header-anchor">#</a> 1.2.1 流程概览</h4> <blockquote><p>这里我们只介绍脚本执行的大致流程，具体的 API 可以<a href="../../api">参考</a></p></blockquote> <ol><li>launch：创建 Browser 对象，使用它对浏览器进行设置
<ol><li>第一个参数为执行 <code>Runner</code>，我们目前支持 puppeteer 与Nightmare 两种，推荐使用 puppeteer</li> <li>第二个参数为配置选项，可以从传入对应的选项，可以<a href="../../api/matman">参考</a></li></ol></li> <li>setDeviceConfig：设置浏览器参数</li> <li>setScreenshotConfig：设置截屏（页面截图保存在 <code>/build/screenshot_output</code> 中）</li> <li>setPageUrl：设置页面地址</li> <li>addAction：无头浏览器支持的行为，在这里推荐所有的第一个行为是形如上方代码中的 init 以抓取初始的数据快照</li> <li>evaluate：用于执行 action 并获取页面中的数据：
<ol><li>接受的参数为函数或者爬虫脚本 <code>绝对路径</code></li> <li>返回的结果为 matmanResult，请<a href="../../api/matman-result">参考</a></li></ol></li></ol> <h4 id="_1-2-2-自测"><a href="#_1-2-2-自测" class="header-anchor">#</a> 1.2.2 自测</h4> <div class="language-js extra-class"><pre class="language-js"><code>module
  <span class="token punctuation">.</span><span class="token function">exports</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;failed:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>编写完成后，如果要自测，可以在文件末尾加入如上代码，然后用 node 执行本文件。</p> <h2 id="_2-编写测试用例"><a href="#_2-编写测试用例" class="header-anchor">#</a> 2. 编写测试用例</h2> <h3 id="_2-1-测试过程分离"><a href="#_2-1-测试过程分离" class="header-anchor">#</a> 2.1 测试过程分离</h3> <blockquote><p>一般情况下我们推荐将 matman 的测试过程与测试样例进行分离，便于维护</p></blockquote> <p>在  <code>test/basic-check.test.js</code> 文件中，对数据快照进行检验，内容如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>expect<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> checkPage <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../case_modules/page_baidu_index/basic-check.matman'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'百度首页：常规检查'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> resultData<span class="token punctuation">;</span>

  <span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">checkPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      show<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SHOW_BROWSER</span> <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      doNotCloseBrowser<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      useRecorder<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">matmanResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log(JSON.stringify(result));</span>
      resultData <span class="token operator">=</span> matmanResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'检查基本信息'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data<span class="token punctuation">;</span>

    <span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'网站title应该为：百度一下，你就知道'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'百度一下，你就知道'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'搜索按钮的文字应该为：百度一下'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>searchBtnTxt<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'百度一下'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'userAgent应该正确'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
        <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36 mycustomua'</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-2-单文件测试"><a href="#_2-2-单文件测试" class="header-anchor">#</a> 2.2 单文件测试</h3> <p>在  <code>test/basic-check-in-single-file.test.js</code> 文件中，同时执行 matman 操作过程与数据快照检验，内容如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> matman <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'matman'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> BrowserRunner <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'matman-runner-puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'百度首页：常规检查（单文件）'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> resultData<span class="token punctuation">;</span>

  <span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">MATMAN_ROOT_PATH</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建 PageDriver 对象，使用它可以实现对浏览器页面的控制</span>
    <span class="token keyword">const</span> pageDriver <span class="token operator">=</span> matman<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BrowserRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      rootPath<span class="token operator">:</span> <span class="token constant">MATMAN_ROOT_PATH</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置浏览器参数</span>
    <span class="token keyword">await</span> pageDriver<span class="token punctuation">.</span><span class="token function">setDeviceConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      userAgent<span class="token operator">:</span>
        <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36 mycustomua'</span><span class="token punctuation">,</span>
      viewport<span class="token operator">:</span> <span class="token punctuation">{</span>
        width<span class="token operator">:</span> <span class="token number">1250</span><span class="token punctuation">,</span>
        height<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置截屏</span>
    <span class="token keyword">await</span> pageDriver<span class="token punctuation">.</span><span class="token function">setScreenshotConfig</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 加载页面地址</span>
    <span class="token keyword">await</span> pageDriver<span class="token punctuation">.</span><span class="token function">setPageUrl</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 需要等待某些条件达成，才开始运行爬虫脚本</span>
    <span class="token keyword">await</span> pageDriver<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">'SCAN_PAGE'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">'#su'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 结束，获取结果</span>
    resultData <span class="token operator">=</span> <span class="token keyword">await</span> pageDriver<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> document<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
        width<span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
        height<span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
        userAgent<span class="token operator">:</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span>
        _version<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        searchBtnTxt<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#su'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'检查基本信息'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data<span class="token punctuation">;</span>

    <span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> resultData<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'网站title应该为：百度一下，你就知道'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'百度一下，你就知道'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'搜索按钮的文字应该为：百度一下'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>searchBtnTxt<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'百度一下'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'userAgent应该正确'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
        <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36 mycustomua'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_3-执行测试"><a href="#_3-执行测试" class="header-anchor">#</a> 3. 执行测试</h2> <p>运行如下命令，执行端对端测试：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token builtin class-name">test</span>
</code></pre></div><p><img src="/matman/assets/img/baidu_01_02.23743ead.jpg" alt=""></p> <p>同时，由于我们配置了测试过程截图，因此可以在 <code>build/screenshot/page_baidu_index_cases</code> 目录下看到截图：</p> <p><img src="/matman/assets/img/baidu_01_basic-check_1.0d544090.jpg" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/matman/docs/install.html" class="prev">
        安装和升级
      </a></span> <span class="next"><a href="/matman/docs/getting-started/baidu_02.html">
        02. 测试用户交互
      </a>
      →
    </span></p></div> </main> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/matman/assets/js/app.b3f8f6ce.js" defer></script><script src="/matman/assets/js/3.401d6b26.js" defer></script><script src="/matman/assets/js/2.d54e6689.js" defer></script><script src="/matman/assets/js/15.b891806f.js" defer></script>
  </body>
</html>
